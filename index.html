<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conference Submission Form</title>
  <style>
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      margin: 20px;
      padding: 20px;
      background-color: #f4f8fb;
      /* Soft light blue background */
      color: #2d3436;
      /* Dark text for readability */
    }

    h2 {
      text-align: center;
      font-size: 2rem;
      color: #2c3e50;
      /* Slightly darker color for headings */
      margin-bottom: 20px;
    }

    form {
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 8px;
      color: #34495e;
      /* Dark gray color for labels */
    }

    input[type="text"],
    input[type="email"],
    input[type="file"],
    textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 18px;
      border: 1px solid #d5dade;
      /* Soft border for inputs */
      border-radius: 8px;
      font-size: 14px;
      background-color: #f6f9fc;
      /* Light background for inputs */
      color: #34495e;
    }

    input[type="file"] {
      padding: 8px 10px;
    }

    button {
      display: block;
      width: 100%;
      padding: 12px;
      background-color: #2980b9;
      /* Bright blue button */
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 10px;
    }

    button:hover {
      background-color: #217dbb;
      /* Slightly darker blue on hover */
    }

    .added-conferences {
      padding: 20px;
      margin: 30px auto;
      width: 70%;
      max-height: 80vh;
      background-color: #2c3e50;
      /* Dark background for list */
      overflow-y: auto;
      color: #ecf0f1;
      /* Light text for contrast */
      border-radius: 8px;
    }

    .card {
      word-wrap: break-word;
      word-break: break-all;
      margin: 10px;
      padding: 15px;
      border-radius: 8px;
      background-color: #ecf0f1;
      border: 2px solid #bdc3c7;
      font-weight: bold;
      color: rebeccapurple;
    }

    .card p {
      padding: 10px;
    }

    .card p strong {
      color: #2c3e50;
      /* Change text color */
      font-weight: bold;
      /* Ensure bold styling */
      font-size: 16px;
      /* Adjust font size */
    }

    .card h4 {
      padding: 5px;
      color: #8e44ad;
      /* Purple color for section headers */
      font-size: 18px;
    }

    .card p {
      font-size: 17px;
      margin: 5px 0;
    }

    .card button {
      width: 100%;
      padding: 10px;
      background-color: #27ae60;
      /* Green action button */
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 10px;
    }

    .card button:hover {
      background-color: #219150;
      /* Darker green on hover */
    }

    .BtnDiv {
      padding-bottom: 20px;
      text-align: center;
      margin: 20px auto;
    }

    .BtnDiv button {
      padding: 12px;
      width: 100%;
      max-width: 320px;
      margin: 10px auto;
      background-color: #e67e22;
      /* Orange for navigation buttons */
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .BtnDiv button:hover {
      background-color: #d35400;
      /* Darker orange on hover */
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      form {
        padding: 15px;
      }

      .added-conferences {
        max-height: 60vh;
      }

      .card button,
      .BtnDiv button {
        width: 90%;
        font-size: 14px;
      }

      .card p {
        font-size: 14px;
      }

      h2 {
        font-size: 1.8rem;
      }
    }

    @media (max-width: 480px) {
      body {
        margin: 10px;
        padding: 10px;
      }

      h2 {
        font-size: 1.6rem;
      }

      input[type="text"],
      input[type="email"],
      input[type="file"],
      textarea {
        padding: 8px;
        font-size: 12px;
      }

      button {
        font-size: 14px;
        padding: 10px;
      }

      .card p {
        font-size: 13px;
      }
    }
  </style>
</head>

<body>
  <center>
    <h1>ICRAMEN 2021 Submission</h1>
  </center>
  <h2>Submit Your Conference Paper</h2>
  <a href="https://karangade24.github.io/RAME24/index1.html"><button>Click to upload books</button><a>
      <form id="conferenceForm" enctype="multipart/form-data">
        <label for="title">Paper Title:</label>
        <input type="text" id="title" name="title" placeholder="Enter your paper title" required />
        <label for="shortcutTitle">Paper shortcut Title:</label>
        <input type="text" id="shortcutTitle" name="shortcutTitle" placeholder="Enter your shortcut paper title"
          required />

        <label for="organizers">organizers: </label>
        <input type="text" id="organizers" name="organizers" rows="3" placeholder="organizers name separated by commas"
          required />

        <label for="conferenceStartDate">conference start date:</label>
        <input type="datetime-local" id="conferenceStartDate" name="conferenceStartDate"
          placeholder="Enter conference start date" required />

        <label for="conferenceEndDate">conference end date:</label>
        <input type="datetime-local" id="conferenceEndDate" name="conferenceEndDate"
          placeholder="Enter conference end date" required />

        <label for="authors">Authors:</label>
        <textarea id="authors" name="authors" rows="3" placeholder="List authors separated by commas"
          required></textarea>

        <label for="email">Contact Email:</label>
        <input type="email" id="email" name="email" placeholder="Enter contact email" required />

        <label for="phone">Contact Phone:</label>
        <input type="text" id="phone" name="phone" placeholder="Enter contact phone number" required />

        <label for="abstract">Abstract:</label>
        <textarea id="abstract" name="abstract" rows="5" placeholder="Enter the abstract of your paper"
          required></textarea>

        <label for="keywords">Keywords:</label>
        <input type="text" id="keywords" name="keywords" placeholder="Enter keywords separated by commas" required />

        <label for="indexed">indexed:</label>
        <input type="text" id="indexed" name="indexed" placeholder="Enter indexed separated by commas" required />

        <label for="track">Conference Track:</label>
        <input type="text" id="track" name="track" placeholder="E.g., Thermal Engineering, Material Science" required />

        <label for="conferenceBanner">Upload conference Banner image</label>
        <input type="file" id="conferenceBanner" name="conferenceBanner" accept="image/*" />
        <label for="file">Upload Paper (PDF):</label>
        <input type="file" id="file" name="paperFile" accept="application/pdf" />

        <label for="schedule">Program Schedule:</label>
        <input type="file" id="schedule" name="programScheduleFile" accept="application/pdf" />

        <label for="presentation">Presentation Schedule:</label>
        <input type="file" id="presentation" name="presentationScheduleFile" accept="application/pdf" />

        <label for="guidelines">Presentation Guidelines:</label>
        <input type="file" id="guidelines" name="presentationGuidelinesFile" accept="application/pdf" />

        <label for="pptFormat">PPT Format (First Slide):</label>
        <input type="file" id="pptFormat" name="pptFormatFile"
          accept="application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation" />

        <label for="venue">Venue Details:</label>
        <textarea id="venue" name="venueDetails" rows="3"
          placeholder="Provide details about the venue or online platform details" required></textarea>

        <label for="registration">Registration Details:</label>
        <textarea id="registration" name="registrationDetails" rows="3"
          placeholder="Provide registration instructions or details" required></textarea>

        <label for="publication">Publication Information:</label>
        <textarea id="publication" name="publicationInfo" rows="3"
          placeholder="Describe where the papers will be published, e.g., IOP Conference Series" required></textarea>

        <button id="btn" type="submit">Submit</button>
        <button type="submit" class="update-btn" style="display: none">Update</button>
      </form>

      <div class="added-conferences"></div>

      <script>
        var responseGet;
        const form = document.getElementById("conferenceForm");
        const updatebtn = document.querySelector(".update-btn");

        const api = "https://8080-idx-rame24-1737798853897.cluster-fu5knmr55rd44vy7k7pxk74ams.cloudworkstations.dev";
        // const api = "https://rame24.onrender.com";

        // Get current date and time in the correct format (yyyy-mm-ddThh:mm)
        const currentDate = new Date();
        const currentDateString = currentDate.toISOString().slice(0, 16); // Format as 'yyyy-mm-ddThh:mm'

        // Remove "min" attribute for the start date to allow past dates
        document.getElementById("conferenceStartDate").removeAttribute("min");

        // Set the "min" attribute for the end date to the current date and time
        document
          .getElementById("conferenceEndDate")
          .setAttribute("min", currentDateString);

        // Add event listener to dynamically update the end date min value based on the selected start date
        document
          .getElementById("conferenceStartDate")
          .addEventListener("change", function () {
            const startDate = document.getElementById(
              "conferenceStartDate"
            ).value;
            document
              .getElementById("conferenceEndDate")
              .setAttribute("min", startDate);
          });

        // Form submission event to show an alert with the selected dates (for testing purposes)
        const conferenceForm = document
          .getElementById("conferenceForm")
        conferenceForm.onsubmit = submit;

        async function submit(event) {
          event.preventDefault(); // Prevent form submission for demo purposes

          const startDate = document.getElementById(
            "conferenceStartDate"
          ).value;
          const endDate = document.getElementById("conferenceEndDate").value;
          // Check if end date is after start date
          if (new Date(endDate) <= new Date(startDate)) {
            alert("End date must be greater than the start date!");
          }
        };

        const submitButton = document.getElementById("btn");

        // submitButton.addEventListener("click", (event) => submitBtn(event));


        form.onsubmit = async (event) => {
          event.preventDefault(); // Prevent traditional form submission
          // const submitButton = document.getElementsByTagName("button")[0];

          submitButton.disabled = true;
          submitButton.innerText = "Submitting...";

          console.log(submitButton.innerText);

          const formData = new FormData(form);
          console.log(formData);

          try {
            const response = await fetch(`${api}/add-conference`, {
              method: "POST",
              body: formData,
            });

            const result = await response.json(); // Parse the response as JSON
            console.log(result);

            alert(result.message);
            // Optionally reset the form
          } catch (error) {
            console.error("Error submitting details:", error);
            alert("Failed to submit the details. Please try again.");
          } finally {
            submitButton.disabled = false;
            submitButton.innerText = "Submit";
            form.reset();
            location.reload();
          }
        };

        //
        //After adding the conferences

        const addConferenceDiv = document.querySelector(".added-conferences");
        var totalPages,
          currentPage = 1,
          response;

        async function getdata(skipNo = 0) {
          const conferenceData = await fetch(
            `${api}/conferences-data/${skipNo}`,
            {
              method: "GET",
            }
          );

          responseGet = await conferenceData.json();
          console.log(responseGet);
          console.log(responseGet.conferenceSubmissions);

          const conferences = responseGet.conferenceSubmissions;
          const totalPages = Math.ceil(responseGet.conferenceCount / 10);

          conferences.forEach((conference) => {
            // Create the main card div
            const card = document.createElement("div");
            card.className = "card";

            // Function to create and append a labeled paragraph
            const createLabeledParagraph = (label, value) => {
              const div = document.createElement("div");
              div.innerHTML = `<p><strong>${label}:</strong> ${value}</p>`;
              card.appendChild(div);
            };

            // Add all fields to the card
            createLabeledParagraph(
              "cover",
              `<img src="${conference.conferenceBanner?.cloudinaryUrl
              }" alt="conferenceBanner" width ="30%" />`
            );
            createLabeledParagraph("title", conference.title);
            createLabeledParagraph("shortTitle", conference.shortcutTitle);
            createLabeledParagraph("authors", conference.authors);
            createLabeledParagraph("organizers", conference.organizers);
            createLabeledParagraph("email", conference.email);
            createLabeledParagraph("phone", conference.phone);
            createLabeledParagraph(
              "conferenceStartDate",
              conference.conferenceStartDate
            );
            createLabeledParagraph(
              "conferenceEndDate",
              conference.conferenceEndDate
            );
            createLabeledParagraph("indexed", conference.indexed);
            createLabeledParagraph("keywords", conference.keywords);
            createLabeledParagraph("publicationInfo", conference.publicationInfo);
            createLabeledParagraph(
              "registrationDetails",
              conference.registrationDetails
            );
            createLabeledParagraph("track", conference.track);
            createLabeledParagraph("venueDetails", conference.venueDetails);
            createLabeledParagraph("abstract", conference.abstract);
            createLabeledParagraph(
              "paperFile",
              `<a href="${conference.paperFile.cloudinaryUrl
              }"target ="_blank">Download Paper</a>`
            );
            createLabeledParagraph(
              "programScheduleFile",
              `<a href="${conference.programScheduleFile.cloudinaryUrl
              }" target ="_blank">Download Paper</a>`
            );
            createLabeledParagraph(
              "presentationScheduleFile",
              `<a href="${conference.presentationScheduleFile.cloudinaryUrl
              }" target ="_blank">Download Paper</a>`
            );
            createLabeledParagraph(
              "presentationGuidelinesFile",
              `<a href="${conference.presentationGuidelinesFile.cloudinaryUrl
              }" target ="_blank">Download Paper</a>`
            );

            createLabeledParagraph(
              "pptFormatFile",
              `<a href="${conference.pptFormatFile.cloudinaryUrl
              }" target ="_blank">Download Paper</a>`
            );

            // Append buttons for update and delete
            card.appendChild(createUpdateBtn(conference._id));
            card.appendChild(createDeleteBtn(conference._id));

            // Append the card to the container
            addConferenceDiv.appendChild(card);
          });
        }

        (async () => {
          await getdata();
          addNextPreviousBtn();
        })();

        //
        //Next and Previous Buttons
        function addNextPreviousBtn() {
          const BtnDiv = document.createElement("div");
          BtnDiv.className = "BtnDiv";
          BtnDiv.appendChild(createNextBtn());
          BtnDiv.appendChild(createPreviousBtn());
          const text = document.createElement("p");
          text.innerText = "PageNO: " + currentPage;
          text.style.color = "antiquewhite";
          text.style.fontSize = "1.3rem";
          BtnDiv.appendChild(text);
          addConferenceDiv.appendChild(BtnDiv);
        }

        //update and delete buttons
        function createUpdateBtn(id) {
          const updateBtn = document.createElement("button");
          updateBtn.className = "btn";
          updateBtn.innerText = "Update";

          updateBtn.addEventListener("click", (e) => {
            e.preventDefault();

            submitButton.style.display = "none";
            updatebtn.style.display = "block";
            var responseData;

            form.reset();
            // console.log(responseGet);

            responseGet.conferenceSubmissions.forEach((ele) => {
              if (ele._id == id) {
                console.log(ele._id);
                responseData = ele;
              }
            });

            // Populate the form fields with existing data
            document.getElementById("title").value = responseData.title || "";
            document.getElementById("shortcutTitle").value =
              responseData.shortcutTitle || "";
            document.getElementById("organizers").value =
              responseData.organizers || "";
            document.getElementById("authors").value = responseData.authors || "";
            document.getElementById("email").value = responseData.email || "";
            document.getElementById("phone").value = responseData.phone || "";
            document.getElementById("abstract").value =
              responseData.abstract || "";
            document.getElementById("keywords").value =
              responseData.keywords || "";
            document.getElementById("indexed").value = responseData.indexed || "";
            document.getElementById("track").value = responseData.track || "";
            document.getElementById("venue").value =
              responseData.venueDetails || "";
            document.getElementById("registration").value =
              responseData.registrationDetails || "";
            document.getElementById("publication").value =
              responseData.publicationInfo || "";
            // Disable submit and make only update work
            form.onsubmit = ((e) => submitSecond(e));

            async function submitSecond(e) {
              e.preventDefault();
              const formData = new FormData(form);
              updatebtn.innerText = "Updating...";
              updatebtn.disabled = true;

              try {
                // console.log("logging id", id);

                // Make the PATCH request
                const response = await fetch(`${api}/update-conference/${id}`, {
                  method: "PATCH",
                  body: formData,
                });

                // Check if the response is ok
                if (!response.ok) {
                  throw new Error(`Failed to update: ${response.statusText}`);
                }

                const responseData = await response.json();

                // Check for server response message
                if (responseData.message) {
                  alert(responseData.message);
                }
              } catch (error) {
                console.error("Error while updating conference:", error);
                alert(`An error occurred: ${error.message}`);
              } finally {
                updatebtn.innerText = "Update";
                updatebtn.disabled = false;
                updatebtn.style.display = "none";
                location.reload();
              }
            }
          });

          return updateBtn;
        }

        function createDeleteBtn(id) {
          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn";
          deleteBtn.innerText = "Delete";

          deleteBtn.addEventListener("click", async (e) => {
            e.preventDefault();

            // Confirm the delete action with the user
            const confirmDelete = confirm(
              "Are you sure you want to delete this item?"
            );
            if (!confirmDelete) return;

            try {
              // Disable the button to prevent multiple clicks
              deleteBtn.disabled = true;
              deleteBtn.innerText = "Deleting...";

              // Send DELETE request to the API
              const response = await fetch(`${api}/delete-conference/${id}`, {
                method: "DELETE",
              });

              // Check if the response is ok
              if (!response.ok) {
                throw new Error(`Failed to delete: ${response.statusText}`);
              }

              const responseData = await response.json();

              // Show success message and remove the item from the UI
              if (responseData.message) {
                alert(responseData.message);
                // Optionally, remove the deleted item's row or card from the UI
                const itemToDelete = document.getElementById(`item-${id}`);
                if (itemToDelete) itemToDelete.remove();
              }
            } catch (error) {
              console.error("Error while deleting conference:", error);
              alert(`An error occurred: ${error.message}`);
            } finally {
              // Reset the button state
              location.reload();
              deleteBtn.disabled = false;
              deleteBtn.innerText = "Delete";
            }
          });

          return deleteBtn;
        }

        //Next and Previous Buttons
        function createNextBtn() {
          const nextBtn = document.createElement("button");
          nextBtn.innerText = "Next";
          if (currentPage == totalPages) {
            nextBtn.disabled = true;
            nextBtn.style.backgroundColor = "#a4bcd7";
          }
          nextBtn.addEventListener("click", async function next() {
            currentPage++;
            if (currentPage <= totalPages) {
              console.log(currentPage);
              let skipNo = (currentPage - 1) * 10;
              addConferenceDiv.innerHTML = "";
              await getdata(skipNo);
              addNextPreviousBtn();
            } else {
              nextBtn.removeEventListener("click", next);
              nextBtn.style.backgroundColor = "#a4bcd7";
            }
          });

          return nextBtn;
        }

        function createPreviousBtn() {
          const previousBtn = document.createElement("button");
          previousBtn.innerText = "Previous";
          if (currentPage == 1) {
            previousBtn.disabled = true;
            previousBtn.style.backgroundColor = "#a4bcd7";
          }
          previousBtn.addEventListener("click", async function previous() {
            currentPage--;
            if (currentPage > 0 && currentPage <= totalPages) {
              console.log(currentPage);
              let skipNo = (currentPage - 1) * 10;
              addConferenceDiv.innerHTML = "";
              await getdata(skipNo);
              addNextPreviousBtn();
            } else {
              previousBtn.removeEventListener("click", previous);
              previousBtn.style.backgroundColor = "#a4bcd7";
            }
          });

          return previousBtn;
        }
      </script>
</body>

</html>